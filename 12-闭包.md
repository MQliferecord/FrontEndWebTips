# 闭包 

### 第一个类型

- 案例1

```javascript
    function fn(f){
        var n = 2;
        f();
    }

    function test(){
        console.log(n);
    }

    fn(test);//报错
```

> 看完这个案例让我们来思考一下案例一里面有没有闭包？2

| 答案是不存在闭包。

- 案例2

```javascript
    function fn(){
        var n = 2;
        return function(){
        console.log(n);
        }
    }

    fn();//没有任何的输出
```

> 看完这个案例让我们来思考一下案例二里面有没有闭包？2

| 答案是`return function(){console.log(n);}`.


- 案例3

```javascript
    function fn(){
        var n = 2;
        return function(){
        console.log(n);
        }
    }

    fn()();//2
```

- 案例4

```javascript
    function fn(){
        var n = 2;
        return function(){
        console.log(n);
        }
    }

    let num = fn();//fn不会输出结果
    console.log(num);//function(){console.log(n);}
```

- 案例5

```javascript
    function fn(){
        var n = 2;
        return function(){
        console.log(n);
        }
    }

    let num = fn();
    console.log(num());//2 undefined
```
### 第二个类型

```javascript
    function foo(){
        var arr = new Array();
        for(var i = 0;i<5;i++){
            arr[i] = i;
        }
        console.log(arr);//[0,1,2,3,4]
    }

    foo();
```

```javascript
    function foo(){
        var arr = new Array();
        for(var i = 0;i<5;i++){
            arr[i] = function(){
                console.log(i);
                return i;
            }  
        }
    }

    foo();//无输出
```

```javascript
    function foo(){
        var arr = new Array();
        for(var i = 0;i<5;i++){
            arr[i] = (function(i){
                console.log(i);
                return i;//[0,1,2,3,4]
            })(i)  
            console.log(arr[i])//[0,1,2,3,4]
        }
    }

    foo(); 
```

```javascript
    var foo = {n:1};
    (function(foo){
        console.log(foo.n);
        foo.n = 3;
        var foo = {n:2};//指向新对象
        console.log(foo.n);
    })(foo)//闭包内的foo被摧毁
    console.log(foo.n);//1 2 3
```
### 第三个类型

```javascript
    var length = 10;
    function fn(){
        console.log(this.length);
    }
    var obj = {
        length:5,
        method:function(fn){
            fn();
        },
        getLength:function(){
            setTimeout(function(){
                console.log(this.length);
            })
        }
    }
    obj.method(fn);//10
    obj.getLength();//10 setTimeout中箭头函数的this永远指向window
```

```javascript
    var length = 10;
    function fn(){
        console.log(this.length);
    }
    var obj = {
        length:5,
        method:function(){
            console.log(this.length);
        },
        getLength:function(){
            setTimeout(function(){
                console.log(this.length);
            })
        }
    }
    obj.method();//5
    obj.getLength();//10
```

```javascript
    var length = 10;
    function fn(){
        console.log(this.length);
    }
    var obj = {
        length:5,
        method:function(){
            console.log(this.length);
        },
        getLength:function(){
            let that = this
            setTimeout(function(){
                console.log(that.length);
            })
        }
    }
    obj.method();//5
    obj.getLength();//5
```

```javascript
    var length = 10;
    function fn(){
        console.log(this.length);
    }
    var obj = {
        length:5,
        method:function(fn){
            fn()
        },
        getLength:function(){
            let that = this
            setTimeout(function(){
                console.log(that.length);
            })
        }
    }
    obj.method(fn.bind(obj));//5
    obj.getLength();//5
```

| 最后一道经典闭包题：你觉得他们的输出分别是什么？

```javascript
    function fun(n,o){
        console.log(o)
        return {
            fun:function(m){
                return fun(m,n)
            }
        }
    }
    var a = fun(0)
    a.fun(1)
    a.fun(2)
    a.fun(3)

    var b = fun(0).fun(1).fun(2).fun(3) 
    var c = fun(0).fun(1)
    c.fun(2)
    c.fun(3)
```

**题解如下：**

```javascript
    function fun(n,o){
        console.log(o)
        return {
            fun:function(m){
                return fun(m,n)
            }
        }
    }
    var a = fun(0)//a = {fun:function(m){return fun(m,n)}} 
    a.fun(1)// m = 1 n = 0 ---console.log 0
    a.fun(2)// m = 2 n = 0 ---console.log 0
    a.fun(3)// m = 3 n = 0 ---console.log 0

    var b = fun(0).fun(1).fun(2).fun(3) 
    /**
     * fun(0) == obj0 == {fun:function(m){return fun(m,n)}} 
     * 
     * fun(0).fun(1) == obj0.fun(1) ---m = 1 n = 0 console.log 0 ---return {fun:function(m){return fun(m,1)}} (==obj1)
     * 
     * fun(0).fun(1).fun(2) == obj0.fun(1).fun(2) == obj1.fun(2) --- m = 2 console.log 1 
     *         ---return {fun:function(m){return fun(m,2)}} (==obj2)
     * 
     * fun(0).fun(1).fun(2).fun(3) == obj2.fun(3) --- m = 3 console.log 2
     * */
    var c = fun(0).fun(1)
     /**
     * fun(0) == obj0 == {fun:function(m){return fun(m,n)}} 
     * fun(0).fun(1) == obj0.fun(1) ---m = 1 n = 0 console.log 0 ---return {fun:function(m){return fun(m,1)}} (==obj1)
     */
    c.fun(2)//m = 2 n = 1 ---console.log 1
    c.fun(3)//m = 3 n = 1 ---console.log 1
```





